---
title: Promise
date: 2020-03-23 12:10:10
tags:
    - Promise
categories: Promise
thumbnail: '../assets/Promise-Face.png'
---
### æ„é€ å‡½æ•°
Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè‡ªå·±èº«ä¸Šæœ‰allã€raceã€rejectã€resolveè¿™å‡ ä¸ªæ–¹æ³•
åŸå‹ä¸Šæœ‰thenã€catchç­‰æ–¹æ³•
<!-- more -->
![](/assets/Promise.png)
#### Promiseå¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹
ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promiseå¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œrejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯Promiseè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚

ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚Promiseå¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»pendingå˜ä¸ºfulfilledå’Œä»pendingå˜ä¸ºrejectedã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹Promiseå¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚

#### new Promise
```
let p = new Promise( function(resolve, reject) {
    setTimeout(function(){
        console.log('æ‰§è¡Œå®ŒæˆPromise');
        resolve('è¦è¿”å›çš„æ•°æ®');
	}, 2000);
})
```
æ‰§è¡Œäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä¹Ÿå°±æ˜¯setTimeoutï¼Œ2ç§’åï¼Œè¾“å‡ºâ€œæ‰§è¡Œå®Œæˆâ€ï¼Œå¹¶ä¸”è°ƒç”¨resolveæ–¹æ³•
ğŸ–ï¼šåªæ˜¯newäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨å®ƒï¼Œä¼ è¿›å»çš„å‡½æ•°å°±å·²ç»æ‰§è¡Œäº†ï¼Œè¿™æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚ã€‚æ‰€ä»¥ç”¨Promiseçš„æ—¶å€™ä¸€èˆ¬æ˜¯åŒ…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å»è¿è¡Œè¿™ä¸ªå‡½æ•°
```
function runAsync(){
    var p = new Promise(function(resolve, reject){
        //åšä¸€äº›å¼‚æ­¥æ“ä½œ
        setTimeout(function(){
            console.log('æ‰§è¡Œå®Œæˆ');
            resolve('éšä¾¿ä»€ä¹ˆæ•°æ®');
        }, 2000);
    });
    return p;            
}
runAsync()
```
åˆ·æ–°é¡µé¢çš„æ—¶å€™æ˜¯æ²¡æœ‰ä»»ä½•åæ˜ çš„ï¼Œä½†æ˜¯ç‚¹å‡»åæ§åˆ¶å°ä¼šå‡ºç°log

å½“æ”¾åœ¨å‡½æ•°é‡Œé¢çš„æ—¶å€™åªæœ‰è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œ
1ã€ä¸ºä»€ä¹ˆè¦æ”¾åœ¨å‡½æ•°é‡Œé¢
2ã€resolveæ˜¯ä¸ªä»€ä¹ˆé¬¼

æˆ‘ä»¬åŒ…è£…å¥½çš„å‡½æ•°æœ€åï¼Œä¼šreturnå‡ºPromiseå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªPromiseå¯¹è±¡ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨Promiseå¯¹è±¡ä¸Šæœ‰thenã€catchæ–¹æ³•äº†ï¼Œè¿™å°±æ˜¯Promiseçš„å¼ºå¤§ä¹‹å¤„äº†ï¼Œçœ‹ä¸‹é¢çš„ä»£ç 
```

runAsync().then(function(data){
    console.log(data);
    //åé¢å¯ä»¥ç”¨ä¼ è¿‡æ¥çš„æ•°æ®åšäº›å…¶ä»–æ“ä½œ
    //......
});
```
æ§åˆ¶å°
>ç‚¹å‡»æ–¹æ³•è¢«è°ƒç”¨
æ‰§è¡Œå®ŒæˆPromise
è¦è¿”å›çš„æ•°æ® hd

å…ˆæ˜¯æ–¹æ³•è¢«è°ƒç”¨æ‰§è¡Œäº†promise,æœ€åæ‰§è¡Œäº†promiseçš„thenæ–¹æ³•ï¼Œthenæ–¹æ³•æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°æ˜¯æ¥å—resolveè¿”å›çš„æ•°æ®è¿™æ—¶å°±è¾“å‡ºäº†'è¦è¿”å›çš„æ•°æ®'

åŸæ¥thené‡Œé¢çš„å‡½æ•°å°±è·Ÿæˆ‘ä»¬å¹³æ—¶çš„å›è°ƒå‡½æ•°ä¸€ä¸ªæ„æ€ï¼Œèƒ½å¤Ÿåœ¨promiseClickè¿™ä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åè¢«æ‰§è¡Œã€‚è¿™å°±æ˜¯Promiseçš„ä½œç”¨äº†ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯èƒ½æŠŠåŸæ¥çš„å›è°ƒå†™æ³•åˆ†ç¦»å‡ºæ¥ï¼Œåœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåï¼Œç”¨é“¾å¼è°ƒç”¨çš„æ–¹å¼æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

Promiseçš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥åœ¨thenæ–¹æ³•ä¸­ç»§ç»­å†™Promiseå¯¹è±¡å¹¶è¿”å›ï¼Œç„¶åç»§ç»­è°ƒç”¨thenæ¥è¿›è¡Œå›è°ƒæ“ä½œ

```
runAsync1()
.then(function(data){
    console.log(data);
    return runAsync2();
})
.then(function(data){
    console.log(data);
    return runAsync3();
})
.then(function(data){
    console.log(data);
});
```
log
>å¼‚æ­¥ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®1
å¼‚æ­¥ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®2
å¼‚æ­¥ä»»åŠ¡3æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®3

runAsync1,runAsync2,runAsync3ä»£ç 
```
function runAsync1(){
    var p = new Promise(function(resolve, reject){
        //åšä¸€äº›å¼‚æ­¥æ“ä½œ
        setTimeout(function(){
            console.log('å¼‚æ­¥ä»»åŠ¡1æ‰§è¡Œå®Œæˆ');
            resolve('éšä¾¿ä»€ä¹ˆæ•°æ®1');
        }, 1000);
    });
    return p;            
}
function runAsync2(){
    var p = new Promise(function(resolve, reject){
        //åšä¸€äº›å¼‚æ­¥æ“ä½œ
        setTimeout(function(){
            console.log('å¼‚æ­¥ä»»åŠ¡2æ‰§è¡Œå®Œæˆ');
            resolve('éšä¾¿ä»€ä¹ˆæ•°æ®2');
        }, 2000);
    });
    return p;            
}
function runAsync3(){
    var p = new Promise(function(resolve, reject){
        //åšä¸€äº›å¼‚æ­¥æ“ä½œ
        setTimeout(function(){
            console.log('å¼‚æ­¥ä»»åŠ¡3æ‰§è¡Œå®Œæˆ');
            resolve('éšä¾¿ä»€ä¹ˆæ•°æ®3');
        }, 2000);
    });
    return p;            
}
```
åœ¨thenæ–¹æ³•ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥returnæ•°æ®è€Œä¸æ˜¯Promiseå¯¹è±¡ï¼Œåœ¨åé¢çš„thenä¸­å°±å¯ä»¥æ¥æ”¶åˆ°æ•°æ®äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç ä¿®æ”¹æˆè¿™æ ·
```

runAsync1()
.then(function(data){
    console.log(data);
    return runAsync2();
})
.then(function(data){
    console.log(data);
    return 'ç›´æ¥è¿”å›æ•°æ®';  //è¿™é‡Œç›´æ¥è¿”å›æ•°æ®
})
.then(function(data){
    console.log(data);
)}
```
log
>å¼‚æ­¥ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®1
å¼‚æ­¥ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®2
ç›´æ¥è¿”å›æ•°æ®

### rejectçš„ç”¨æ³•
```

function getNumber(){
    var p = new Promise(function(resolve, reject){
        //åšä¸€äº›å¼‚æ­¥æ“ä½œ
        setTimeout(function(){
            var num = Math.ceil(Math.random()*10); //ç”Ÿæˆ1-10çš„éšæœºæ•°
            if(num<=5){
                resolve(num);
            }
            else{
                reject('æ•°å­—å¤ªå¤§äº†');
            }
        }, 2000);
    });
    return p;            
}
 
getNumber()
.then(
    function(data){
        console.log('resolved');
        console.log(data);
    }, 
    function(reason){
        console.log('rejected');
        console.log(reason);
    }
);
```
getNumberå‡½æ•°ç”¨æ¥å¼‚æ­¥è·å–ä¸€ä¸ªæ•°å­—ï¼Œ2ç§’åæ‰§è¡Œå®Œæˆï¼Œå¦‚æœæ•°å­—å°äºç­‰äº5ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯â€œæˆåŠŸâ€äº†ï¼Œè°ƒç”¨resolveä¿®æ”¹Promiseçš„çŠ¶æ€ã€‚å¦åˆ™æˆ‘ä»¬è®¤ä¸ºæ˜¯â€œå¤±è´¥â€äº†ï¼Œè°ƒç”¨rejectå¹¶ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œä½œä¸ºå¤±è´¥çš„åŸå› ã€‚ Â  è¿è¡ŒgetNumberå¹¶ä¸”åœ¨thenä¸­ä¼ äº†ä¸¤ä¸ªå‚æ•°ï¼Œthenæ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå¯¹åº”resolveçš„å›è°ƒï¼Œç¬¬äºŒä¸ªå¯¹åº”rejectçš„å›è°ƒã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿåˆ†åˆ«æ‹¿åˆ°ä»–ä»¬ä¼ è¿‡æ¥çš„æ•°æ®ã€‚å¤šæ¬¡è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ ä¼šéšæœºå¾—åˆ°ä¸‹é¢ä¸¤ç§ç»“æœ
log
>resolved 
1

>rejected
æ•°å­—å¤ªå¤§äº†

### catchçš„ç”¨æ³•
æˆ‘ä»¬çŸ¥é“Promiseå¯¹è±¡é™¤äº†thenæ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªcatchæ–¹æ³•ï¼Œå®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿå…¶å®å®ƒå’Œthençš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼Œç”¨æ¥æŒ‡å®šrejectçš„å›è°ƒï¼Œç”¨æ³•æ˜¯è¿™æ ·
```
getNumber()
.then(function(data){
    console.log('resolved');
    console.log(data);
})
.catch(function(reason){
    console.log('rejected');
    console.log(reason);
});
```
æ•ˆæœå’Œå†™åœ¨thençš„ç¬¬äºŒä¸ªå‚æ•°é‡Œé¢ä¸€æ ·ã€‚ä¸è¿‡å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªä½œç”¨ï¼šåœ¨æ‰§è¡Œresolveçš„å›è°ƒï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢thenä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ—¶ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä»£ç å‡ºé”™äº†ï¼‰ï¼Œé‚£ä¹ˆå¹¶ä¸ä¼šæŠ¥é”™å¡æ­»jsï¼Œè€Œæ˜¯ä¼šè¿›åˆ°è¿™ä¸ªcatchæ–¹æ³•ä¸­ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç 
```
getNumber()
.then(function(data){
    console.log('resolved');
    console.log(data);
    console.log(somedata); //æ­¤å¤„çš„somedataæœªå®šä¹‰
})
.catch(function(reason){
    console.log('rejected');
    console.log(reason);
});
```
åœ¨resolveçš„å›è°ƒä¸­ï¼Œæˆ‘ä»¬console.log(somedata);è€Œsomedataè¿™ä¸ªå˜é‡æ˜¯æ²¡æœ‰è¢«å®šä¹‰çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸ç”¨Promiseï¼Œä»£ç è¿è¡Œåˆ°è¿™é‡Œå°±ç›´æ¥åœ¨æ§åˆ¶å°æŠ¥é”™äº†ï¼Œä¸å¾€ä¸‹è¿è¡Œäº†ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœ

log
>resolved
1
somedata is not defined

ä¹Ÿå°±æ˜¯è¯´è¿›åˆ°catchæ–¹æ³•é‡Œé¢å»äº†ï¼Œè€Œä¸”æŠŠé”™è¯¯åŸå› ä¼ åˆ°äº†reasonå‚æ•°ä¸­ã€‚å³ä¾¿æ˜¯æœ‰é”™è¯¯çš„ä»£ç ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼Œè¿™ä¸æˆ‘ä»¬çš„try/catchè¯­å¥æœ‰ç›¸åŒçš„åŠŸèƒ½

### all çš„ç”¨æ³•
Promiseçš„allæ–¹æ³•æä¾›äº†å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œçš„èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚æˆ‘ä»¬ä»æ—§ä½¿ç”¨ä¸Šé¢å®šä¹‰å¥½çš„runAsync1ã€runAsync2ã€runAsync3è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­
```
Promise
.all([runAsync1(), runAsync2(), runAsync3()])
.then(function(results){
    console.log(results);
});
```
Promise.allæ¥æ‰§è¡Œï¼Œallæ¥æ”¶ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œè¿™ç»„å‚æ•°ä¸ºéœ€è¦æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ‰€æœ‰æ–¹æ³•ï¼Œé‡Œé¢çš„å€¼æœ€ç»ˆéƒ½ç®—è¿”å›Promiseå¯¹è±¡ã€‚
è¿™æ ·ï¼Œä¸‰ä¸ªå¼‚æ­¥æ“ä½œçš„å¹¶è¡Œæ‰§è¡Œçš„ï¼Œç­‰åˆ°å®ƒä»¬éƒ½æ‰§è¡Œå®Œåæ‰ä¼šè¿›åˆ°thené‡Œé¢ã€‚
é‚£ä¹ˆï¼Œä¸‰ä¸ªå¼‚æ­¥æ“ä½œè¿”å›çš„æ•°æ®éƒ½åœ¨thené‡Œé¢ï¼Œallä¼šæŠŠæ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœæ”¾è¿›ä¸€ä¸ªæ•°ç»„ä¸­ä¼ ç»™then
ç„¶åå†æ‰§è¡Œthenæ–¹æ³•çš„æˆåŠŸå›è°ƒå°†ç»“æœæ¥æ”¶ï¼Œç»“æœå¦‚ä¸‹ï¼šï¼ˆåˆ†åˆ«æ‰§è¡Œå¾—åˆ°ç»“æœï¼Œallç»Ÿä¸€æ‰§è¡Œå®Œä¸‰ä¸ªå‡½æ•°å¹¶å°†å€¼å­˜åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢è¿”å›ç»™thenè¿›è¡Œå›è°ƒè¾“å‡ºï¼‰

log
>å¼‚æ­¥ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
å¼‚æ­¥ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
å¼‚æ­¥ä»»åŠ¡3æ‰§è¡Œå®Œæˆ
['éšä¾¿ä»€ä¹ˆæ•°æ®1', 'éšä¾¿ä»€ä¹ˆæ•°æ®2' ,'éšä¾¿ä»€ä¹ˆæ•°æ®3']

è¿™æ ·ä»¥åå°±å¯ä»¥ç”¨allå¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå›è°ƒä¸­å¤„ç†æ‰€æœ‰çš„è¿”å›æ•°æ®ï¼Œæ¯”å¦‚ä½ éœ€è¦æå‰å‡†å¤‡å¥½æ‰€æœ‰æ•°æ®æ‰æ¸²æŸ“é¡µé¢çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨all,æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œå°†æ‰€æœ‰çš„æ•°æ®å¤„ç†å¥½ï¼Œå†å»æ¸²æŸ“

### raceçš„ç”¨æ³•
allæ–¹æ³•çš„æ•ˆæœå®é™…ä¸Šæ˜¯ã€Œè°è·‘çš„æ…¢ï¼Œä»¥è°ä¸ºå‡†æ‰§è¡Œå›è°ƒã€ï¼Œé‚£ä¹ˆç›¸å¯¹çš„å°±æœ‰å¦ä¸€ä¸ªæ–¹æ³•ã€Œè°è·‘çš„å¿«ï¼Œä»¥è°ä¸ºå‡†æ‰§è¡Œå›è°ƒã€ï¼Œè¿™å°±æ˜¯raceæ–¹æ³•ï¼Œè¿™ä¸ªè¯æœ¬æ¥å°±æ˜¯èµ›è·‘çš„æ„æ€ã€‚raceçš„ç”¨æ³•ä¸allä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢runAsync1çš„å»¶æ—¶æ”¹ä¸º1ç§’æ¥çœ‹ä¸€ä¸‹
```
Promise
.race([runAsync1(), runAsync2(), runAsync3()])
.then(function(results){
    console.log(results);
});
```
è¿™ä¸‰ä¸ªå¼‚æ­¥æ“ä½œåŒæ ·æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚ç»“æœä½ åº”è¯¥å¯ä»¥çŒœåˆ°ï¼Œ1ç§’årunAsync1å·²ç»æ‰§è¡Œå®Œäº†ï¼Œæ­¤æ—¶thené‡Œé¢çš„å°±æ‰§è¡Œäº†ã€‚ç»“æœæ˜¯è¿™æ ·çš„
log
>å¼‚æ­¥ä»»åŠ¡1æ‰§è¡Œå®Œæˆ
éšä¾¿ä»€ä¹ˆæ•°æ®1
å¼‚æ­¥ä»»åŠ¡2æ‰§è¡Œå®Œæˆ
å¼‚æ­¥ä»»åŠ¡3æ‰§è¡Œå®Œæˆ

åœ¨thené‡Œé¢çš„å›è°ƒå¼€å§‹æ‰§è¡Œæ—¶ï¼ŒrunAsync2()å’ŒrunAsync3()å¹¶æ²¡æœ‰åœæ­¢ï¼Œä»æ—§å†æ‰§è¡Œã€‚äºæ˜¯å†è¿‡1ç§’åï¼Œè¾“å‡ºäº†ä»–ä»¬ç»“æŸçš„æ ‡å¿—ã€‚   è¿™ä¸ªraceæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä½¿ç”¨åœºæ™¯è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨raceç»™æŸä¸ªå¼‚æ­¥è¯·æ±‚è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”åœ¨è¶…æ—¶åæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä»£ç å¦‚ä¸‹
```
//è¯·æ±‚æŸä¸ªtableæ•°æ®
    function requestTableList(){
        var p = new Promise((resolve, reject) => {
               //å»åå°è¯·æ±‚æ•°æ®ï¼Œè¿™é‡Œå¯ä»¥æ˜¯ajax,å¯ä»¥æ˜¯axios,å¯ä»¥æ˜¯fetch 
                resolve(res);
        });
        return p;
    }
  //å»¶æ—¶å‡½æ•°ï¼Œç”¨äºç»™è¯·æ±‚è®¡æ—¶ 10s
      function timeout(){
          var p = new Promise((resolve, reject) => {
              setTimeout(() => {
                  reject('è¯·æ±‚è¶…æ—¶');
              }, 10000);
          });
          return p;
      }
Promise.race([requestTableList(), timeout()]).then((data) =>{
    //è¿›è¡ŒæˆåŠŸå›è°ƒå¤„ç†
    console.log(data);
}).catch((err) => {
    // å¤±è´¥å›è°ƒå¤„ç†
        console.log(err);
});
```
requestTableListå‡½æ•°ä¼šå¼‚æ­¥è¯·æ•°æ®ï¼Œtimeoutå‡½æ•°æ˜¯ä¸€ä¸ªå»¶æ—¶5ç§’çš„å¼‚æ­¥æ“ä½œã€‚æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªè¿”å›Promiseå¯¹è±¡çš„å‡½æ•°æ”¾è¿›raceï¼Œäºæ˜¯ä»–ä¿©å°±ä¼šèµ›è·‘ï¼Œå¦‚æœ5ç§’ä¹‹å†…æ•°æ®è¯·æ±‚æˆåŠŸäº†ï¼Œé‚£ä¹ˆéè¿›å…¥thenæ–¹æ³•ï¼Œæ‰§è¡Œæ­£å¸¸çš„æµç¨‹ã€‚å¦‚æœ5ç§’é’Ÿæ•°æ®è¿˜æœªæˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆtimeoutå°±è·‘èµ¢äº†ï¼Œåˆ™è¿›å…¥catchï¼ŒæŠ¥å‡ºâ€œè¯·æ±‚è¶…æ—¶â€çš„ä¿¡æ¯