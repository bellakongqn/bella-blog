---
title: å®¢æˆ·ç«¯å­˜å‚¨
date: 2021-02-03 20:52:10
---
åœ¨å®¢æˆ·ç«¯å­˜å‚¨ä¿¡æ¯, æ–¹å¼ï¼šcookie, sessionStorage, localStorage, IndexedDB
<!-- more -->
### cookie
æœåŠ¡ç«¯åœ¨å“åº”httpè¯·æ±‚æ—¶ï¼Œé€šè¿‡å‘é€Set-Cookie HTTPå¤´éƒ¨åŒ…å«ä¼šè¯ä¿¡æ¯ã€‚
httpå“åº”:
Set-Cookie: name=value
æµè§ˆå™¨å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œå¹¶åœ¨ä¹‹åçš„æ¯ä¸ªè¯·æ±‚ä¸­é€šè¿‡HTTPå¤´éƒ¨cookieå†å°†å®ƒä»¬å‘é€å›æœåŠ¡å™¨
httpè¯·æ±‚:
cookie: name=value
è¿™äº›å‘å›æœåŠ¡å™¨çš„é¢å¤–ä¿¡æ¯å¯ç”¨äºå”¯ä¸€æ ‡è¯†å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯

#### cookieæ˜¯ä¸ç‰¹å®šåŸŸè¿›è¡Œç»‘å®šçš„ã€‚
è®¾ç½®cookieåï¼Œå®ƒä¼šä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°åˆ›å»ºå®ƒçš„åŸŸã€‚è¿™ä¸ªé™åˆ¶èƒ½ä¿è¯cookieä¸­å­˜å‚¨çš„ä¿¡æ¯åªå¯¹è¢«è®¤å¯çš„æ¥å—è€…å¼€æ”¾ï¼Œä¸è¢«å…¶ä»–åŸŸè®¿é—®ã€‚ï¼ˆå³åŒæºç­–ç•¥ï¼‰

æ¯ä¸ªåŸŸèƒ½è®¾ç½®çš„cookieæ€»æ•°æ˜¯å—é™åˆ¶çš„ï¼Œä½†æ˜¯ä¸åŒæµè§ˆå™¨ä¸ä¸€è‡´ã€‚

#### cookieçš„æ„æˆ
åç§°ï¼š å”¯ä¸€æ ‡è¯†cookieçš„åç§°
å€¼ï¼šå­˜å‚¨åœ¨cookieä¸­çš„å­—ç¬¦ä¸²å€¼
åŸŸï¼šcookieæœ‰æ•ˆçš„åŸŸã€‚å‘é€åˆ°è¿™ä¸ªåŸŸçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šåŒ…å«å¯¹äºçš„cookie. è¿™ä¸ªåŸŸå¯èƒ½åŒ…å«å­åŸŸï¼Œä¹Ÿå¯ä¸åŒ…å«ã€‚å¦‚æœä¸æ˜ç¡®è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºè®¾ç½®cookieçš„åŸŸ
è·¯å¾„ï¼šè¯·æ±‚URLä¸­åŒ…å«è¿™ä¸ªè·¯å¾„ï¼Œæ‰ä¼šæŠŠcookieå‘é€åˆ°æœåŠ¡å™¨
è¿‡æœŸæ—¶é—´ï¼šè¡¨ç¤ºä½•æ—¶åˆ é™¤cookieçš„æ—¶é—´æˆ³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šè¯ç»“æŸä¼šåˆ é™¤æ‰€æœ‰cookieã€‚ä¸è¿‡ä¹Ÿå¯ä»¥è®¾ç½®ï¼Œç”¨æ¥æŒ‡å®šå…·ä½“çš„åˆ é™¤cookieçš„æ—¶é—´ã€‚è®¾ç½®è¿‡å»çš„æ—¶é—´ä¼šç«‹å³åˆ é™¤cookieã€‚
å®‰å…¨æ ‡è¯†ï¼šè®¾ç½®åï¼Œåœ¨SSLå®‰å…¨é“¾æ¥ä¸‹æ‰ä¼šæŠŠcookieå‘é€åˆ°æµè§ˆå™¨ã€‚(å”¯ä¸€ä¸€ä¸ªéå/å€¼å¯¹)

è¿™äº›å‚æ•°åœ¨Set-Cookieçš„å¤´éƒ¨ç”¨åˆ†å·åŠ ç©ºæ ¼éš”å¼€
Set-Cookie: name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.wrox.com; path=/; secure
å®é™…å‘é€åˆ°æœåŠ¡å™¨çš„åªæœ‰cookieçš„å/å€¼å¯¹ï¼Œ å…¶ä½™expiresç­‰éƒ½ä¸ä¼šå‘é€ã€‚

document.cookieè¿”å›åŒ…å«é¡µé¢ä¸­æ‰€æœ‰çš„æœ‰æ•ˆcookieçš„å­—ç¬¦ä¸²ã€‚ä¹Ÿå¯ä»¥é€šè¿‡document.cookieæ¥è®¾ç½®æ–°çš„cookieå­—ç¬¦ä¸²ã€‚å°†è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºè¿‡å»æˆ–è€…å°†å€¼è®¾ä¸ºç©ºå­—ç¬¦ä¸²å¯ä»¥åˆ é™¤cookie

åœ¨jsä¸­è¯»å†™cookieä¸æ˜¯å¾ˆç›´è§‚ -> è¾…åŠ©å‡½æ•° CookieUtil

å­cookie è¾…åŠ©å‡½æ•° -> SubCookieUtil
ä¸ºç»•è¿‡æµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸcookieæ•°çš„é™åˆ¶ï¼Œæå‡ºæ¥å­Cookieçš„æ¦‚å¿µã€‚
name=name1=value1&name2=value2&name3=value3&name4=value4&name5=value5
ç„¶åé€šè¿‡è§£ææ‹¿åˆ°æ‰€æœ‰cookieå€¼

ğŸ·ï¼š è¿˜æœ‰ä¸€ç§å«åšHTTP-onlyçš„cookieã€‚å®ƒæ—¢å¯ä»¥åœ¨æµè§ˆå™¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨è®¾ç½®ï¼Œä½†åªèƒ½åœ¨æœåŠ¡å™¨è¯»å–ã€‚

### Web Storage
è§£å†³ é€šè¿‡å®¢æˆ·ç«¯å­˜å‚¨ ä¸éœ€è¦é¢‘ç¹å‘é€å›æœåŠ¡å™¨çš„æ•°æ® æ—¶ ä½¿ç”¨cookieçš„é—®é¢˜ã€‚
åŒ…æ‹¬localStorage å’Œ sessionStorage

Storageç±»å‹ç”¨æ¥ä¿å­˜å/å€¼å¯¹æ•°æ®ï¼Œç›´è‡³å­˜å‚¨ç©ºé—´ä¸Šé™ï¼ˆç”±æµè§ˆå™¨å†³å®šï¼‰ã€‚
clear(): åˆ é™¤æ‰€æœ‰å€¼
getItem(name): å–ç»™å®šnameçš„å€¼
key(index):å–ç»™å®šæ•°å€¼ä½ç½®çš„åç§°
removeItem(name):åˆ é™¤ç»™å®šnameçš„å/å€¼å¯¹ã€‚
setItem(name, value): è®¾ç½®ç»™å®šnameçš„å€¼ã€‚
ä¹Ÿå¯ä»¥ä½¿ç”¨deleteæ“ä½œç¬¦åˆ é™¤å±æ€§ï¼Œ é€šè¿‡lengthå±æ€§å¯ä»¥ç¡®å®šStorageå¯¹è±¡ä¸­ä¿å­˜äº†å¤šå°‘å/å€¼å¯¹ã€‚

#### sessionStorage
åªå­˜å‚¨ä¼šè¯æ•°æ®ï¼Œè¿™æ„å‘³ç€æ•°æ®åªä¼šå­˜å‚¨åˆ°æµè§ˆå™¨å…³é—­ã€‚å­˜å‚¨åœ¨sessionStorageå¯¹è±¡ä¸­çš„æ•°æ®åªèƒ½ç”±æœ€åˆå­˜å‚¨æ•°æ®çš„é¡µé¢ä½¿ç”¨ã€‚åœ¨å¤šé¡µåº”ç”¨ç¨‹åºä¸­çš„ç”¨å¤„æœ‰é™ã€‚

é€šè¿‡Web Storageå†™å…¥çš„æ•°æ®éƒ½å¯ä»¥ç«‹å³è¢«è¯»å–ã€‚

éå†
```
sessionStorage.setItem('bella', 'xixi')
sessionStorage.length
sessionStorage.setItem('waytt', 'hhaa')
for(let i = 0; i<sessionStorage.length; i++ ){
  let key = sessionStorage.key(i)
  let value = sessionStorage.getItem(key)
  console.log(key, value)
}
```

#### localStorage
åœ¨å®¢æˆ·ç«¯æŒä¹…å­˜å‚¨æ•°æ®ã€‚
è¦è®¿é—®åŒä¸€ä¸ªlocalStorageå¯¹è±¡ï¼Œé¡µé¢å¿…é¡»æ¥è‡ªåŒä¸€ä¸ªåŸŸï¼ˆå­åŸŸä¸å¯ï¼‰,åœ¨ç›¸åŒçš„ç«¯å£ä½¿ç”¨ç›¸åŒçš„åè®®ã€‚
åŒsessionStorageç”¨æ³•ä¸€è‡´ã€‚

#### å­˜å‚¨äº‹ä»¶
æ¯å½“Storageå¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šè§¦å‘storageäº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶çš„äº‹ä»¶å¯¹è±¡å±æ€§ï¼š
domain:å­˜å‚¨å˜åŒ–çš„åŸŸ
key:è¢«è®¾ç½®æˆ–åˆ é™¤çš„é”®
newValue:é”®è¢«è®¾ç½®çš„æ–°å€¼ï¼Œè‹¥é”®è¢«åˆ é™¤åˆ™ä¸ºnull
oldValue: é”®å˜åŒ–ä¹‹å‰çš„å€¼ã€‚

```
  window.addEventListener('storage', (e)=>{
    console.log(e.domian)
  })
```

localStorageå’Œ sessionStorageä¸Šçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šè§¦å‘storageäº‹ä»¶ï¼Œä½†storageä¸åŒºåˆ†è¿™ä¸¤è€…ã€‚
ï¼ˆå¯ä»¥ç”¨æ¥è§£å†³åœ¨ä¸¤ä¸ªé¡µé¢æ‰“å¼€è´­ç‰©è½¦ï¼Œåˆ†åˆ«æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„åŒæ­¥äº‹ä»¶ï¼‰

### IndexedDB
IndexedDBæ•°æ®åº“å°±æ˜¯åœ¨ä¸€ä¸ªå…¬å…±å‘½åç©ºé—´ä¸‹çš„ä¸€ç»„å¯¹è±¡å­˜å‚¨ã€‚

ä½¿ç”¨IndexedDBæ•°æ®åº“çš„ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨indexedDB.open()æ–¹æ³•ï¼Œå¹¶ç»™å®ƒä¼ å…¥ä¸€ä¸ªè¦æ‰“å¼€çš„æ•°æ®åº“åç§°ã€‚å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™å‘é€ä¸€ä¸ªæ‰“å¼€å®ƒçš„è¯·æ±‚ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåˆ›å»ºå¹¶æ‰“å¼€è¿™ä¸ªæ•°æ®åº“çš„è¯·æ±‚ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›IDBRequestçš„å®ä¾‹ï¼Œå¯ä»¥æ·»åŠ onerrorå’Œonsuccessäº‹ä»¶å¤„ç†ç¨‹åºã€‚

å»ºç«‹æ•°æ®åº“è¿æ¥ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä½¿ç”¨å¯¹è±¡å­˜å‚¨ã€‚ğŸ¤”ï¼šå­˜å‚¨ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚
åˆ›å»ºå¯¹è±¡å­˜å‚¨æ˜¯å¿…é¡»æŒ‡å®šä¸€ä¸ªé”®ã€‚ä¸å­˜åœ¨openä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“ï¼Œç„¶åè§¦å‘onupgradeneededäº‹ä»¶ï¼Œå¯ä»¥ä¸ºè¿™ä¸ªäº‹ä»¶è®¾ç½®å¤„ç†ç¨‹åº
```
request.onupgradeneeded = (e) => {
  const db = e.target.result
  if(db.objectStoreNames.contains('users')) {
    db.deleteObjectStore('users')
  }
  db.createObjectStore('users', {keyPath: 'username'})
}
```
#### äº‹åŠ¡
åˆ›å»ºå¯¹è±¡å­˜å‚¨ä¹‹åï¼Œå‰©ä¸‹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡äº‹åŠ¡å®Œæˆçš„ã€‚
let transaction = db.transaction()
ä¸æŒ‡å®šå‚æ•°ï¼Œåˆ™å¯¹æ•°æ®åº“ä¸­æ‰€æœ‰çš„å¯¹è±¡å­˜å‚¨æœ‰åªè¯»æƒé™ã€‚æŒ‡å®šå‚æ•°
let transaction = db.transaction('users') ->
ç¡®ä¿åœ¨äº‹åŠ¡æœŸé—´åªåŠ è½½userså¯¹è±¡å­˜å‚¨ä¸­çš„ä¿¡æ¯ã€‚å¤šä¸ªä¼ å…¥æ•°ç»„ã€‚

ä¿®æ”¹è®¿é—®æ¨¡å¼ï¼š readonly , readwrite, versionchange
let transaction = db.transaction('users', 'readwrite') -> 
è¿™æ ·äº‹åŠ¡å°±å¯ä»¥å¯¹userså¯¹è±¡å­˜å‚¨è¿›è¡Œè¯»å†™

æœ‰äº†äº‹åŠ¡çš„å¼•ç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨objectStore()æ–¹æ³•å¹¶ä¼ å…¥å¯¹è±¡å­˜å‚¨çš„åç§°ä»¥è®¿é—®ç‰¹å®šçš„å¯¹è±¡å­˜å‚¨ã€‚
add() put() æ·»åŠ å’Œæ›´æ–°å¯¹è±¡ã€‚get()è·å–å¯¹è±¡ï¼Œ delete()åˆ é™¤å¯¹è±¡ clear()åˆ é™¤æ‰€æœ‰å¯¹è±¡ã€‚
è¿™äº›æ–¹æ³•éƒ½åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡ã€‚

let transaction = db.transaction('users')
store = transaction.objectStore('users')
request = store.get('007')
request.onerror
request.onsuccess

äº‹åŠ¡å¯ä»¥å®Œæˆè¯·æ±‚ï¼Œäº‹åŠ¡æœ¬èº«ä¹Ÿæœ‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚onerror å’Œ oncomplete

#### æ¸¸æ ‡æŸ¥è¯¢
ä½¿ç”¨äº‹åŠ¡å¯ä»¥é€šè¿‡ä¸€ä¸ªå·²çŸ¥é”®è·å–ä¸€æ¡æ•°æ®ã€‚è·å–å¤šæ¡æ•°æ®ï¼Œéœ€åœ¨äº‹åŠ¡ä¸­åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡ã€‚æ¸¸æ ‡æ˜¯æŒ‡å‘ç»“æœé›†çš„æŒ‡é’ˆã€‚
å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨openCursor()åˆ›å»ºæ¸¸æ ‡ã€‚ä¹Ÿè¿”å›ä¸€ä¸ªè¯·æ±‚ã€‚
let transaction = db.transaction('users')
store = transaction.objectStore('users')
request = store.openCursor()
request.onerror
request.onsuccess -> e.target.resultè®¿é—®å¯¹è±¡å­˜å‚¨ä¸­çš„ä¸‹ä¸€æ¡æ•°æ®ã€‚

IDBCursorå®ä¾‹å±æ€§ direction / key/ value/ primaryKey
æ¸¸æ ‡å¯ä»¥ç”¨æ¥æ›´æ–°ä¸ªåˆ«è®°å½•ã€‚cursor.update()
åˆ é™¤cursor.delete()
é»˜è®¤æƒ…å†µä¸‹æ¸¸æ ‡åªä¼šåˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œè¦åˆ›å»ºå¦ä¸€ä¸ªè¯·æ±‚ï¼Œ-> 
continue(key)
advance(count)

#### é”®èŒƒå›´
IDBKeyRange.only('007')
IDBKeyRange.lowerBound('007') // ä»007å¼€å§‹åˆ°æœ€å
IDBKeyRange.lowerBound('007', true) // ä»007çš„ä¸‹ä¸€æ¡å¼€å§‹åˆ°æœ€å
IDBKeyRange.upperBound('007') 
range = IDBKeyRange.upperBound('007', true) 
store.openCursor(range)

#### æ¸¸æ ‡æ–¹å‘
openCursoræ¥æ”¶ä¸¤ä¸ªå€¼
ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnull é»˜è®¤é”®çš„èŒƒå›´æ˜¯æ‰€æœ‰å€¼ã€‚
ç¬¬äºŒä¸ªå‚æ•° prev prevunique  nextunique

#### ç´¢å¼•
éœ€è¦ä¸ºå¯¹è±¡å‚¨å­˜æŒ‡å®šå¤šä¸ªé”®ã€‚å°†ç”¨æˆ·idä½œä¸ºä¸»é”®ï¼Œåœ¨ç”¨æˆ·åä¸Šåˆ›å»ºç´¢å¼•ã€‚
let transaction = db.transaction('users')
store = transaction.objectStore('users')
index = store.createIndex('username', 'username', {unique: true})
ç¬¬ä¸€ä¸ªæ˜¯ç´¢å¼•çš„åç§°ï¼Œ ç¬¬äºŒä¸ªæ˜¯ç´¢å¼•å±æ€§çš„åç§°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åŒ…å«é”®uniqueçš„optionså¯¹è±¡ã€‚

åœ¨å¯¹è±¡å­˜å‚¨ä¸Šè°ƒç”¨index()ä¹Ÿå¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå®ä¾‹ã€‚
let transaction = db.transaction('users')
store = transaction.objectStore('users')
index = store.index('username')
å¯ä»¥åœ¨ç´¢å¼•ä¸Šåˆ›å»ºæ¸¸æ ‡




