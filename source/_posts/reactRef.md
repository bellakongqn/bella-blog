---
title: React Ref å—æ§ç»„ä»¶ä¸ä¸å—æ§ç»„ä»¶
tags:
    - React
categories: React
---

Refs æ˜¯ä¸€ä¸ª è·å– DOMèŠ‚ç‚¹æˆ– Reactå…ƒç´ å®ä¾‹çš„å·¥å…·ã€‚åœ¨ React ä¸­ Refs æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå…è®¸ç”¨æˆ·è®¿é—®DOM èŠ‚ç‚¹æˆ–è€…åœ¨renderæ–¹æ³•ä¸­åˆ›å»ºçš„Reactå…ƒç´ ã€‚

<!-- more -->

å½“refå±æ€§ç”¨äºæ™®é€š HTML å…ƒç´ 
1. ç”¨æ³•1---å­—ç¬¦ä¸²
```
<input  type ="text" ref="input"/> 
```
    // è·å–å€¼çš„æ–¹æ³•ä¸º
    this.refs.input.value

    // domæ“ä½œæ–¹æ³• é€‰ä¸­ èšç„¦
    this.refs.input.select()
    this.refs.input.focus()

ğŸ–ï¼šthis.refs.inputå¯ä»¥è®¿é—®åˆ°è¯¥ç»„ä»¶å®ä¾‹ï¼Œå…¶å®å°±æ˜¯domå…ƒç´ èŠ‚ç‚¹ã€‚è¿™ç§æ–¹å¼åŸºæœ¬ä¸æ¨èä½¿ç”¨ï¼Œæˆ–è€…åœ¨æœªæ¥çš„reactç‰ˆæœ¬ä¸­ä¸ä¼šå†æ”¯æŒè¯¥æ–¹å¼ï¼Œä½†æ˜¯å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚

2. ç”¨æ³•2---å›è°ƒå‡½æ•°
```
<input  type ="text" ref={(input) => {this.input =  input}}/> 
```
    // è·å–å€¼çš„æ–¹æ³•ä¸º
    this.input.value

    // domæ“ä½œæ–¹æ³• é€‰ä¸­ èšç„¦
    this.input.select()
    this.input.focus()

ğŸ’ï¼šå›è°ƒå‡½æ•°å°±æ˜¯åœ¨domèŠ‚ç‚¹æˆ–ç»„ä»¶ä¸ŠæŒ‚è½½å‡½æ•°ï¼Œå‡½æ•°çš„å…¥å‚æ˜¯domèŠ‚ç‚¹æˆ–ç»„ä»¶å®ä¾‹ï¼Œè¾¾åˆ°çš„æ•ˆæœä¸å­—ç¬¦ä¸²å½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è·å–å…¶å¼•ç”¨ã€‚

3. ç”¨æ³•3---React.createRef()
```
 <input  type ="text" ref={this.myRef} />
```
    é¦–å…ˆè¦åœ¨constructorè¿›è¡Œè®¾ç½®

```
constructor() {
        super()
        this.myRef = React.createRef();
    }
```
    // è·å–å€¼çš„æ–¹æ³•ä¸º
    this.myRef.current.value

    // domæ“ä½œæ–¹æ³• é€‰ä¸­ èšç„¦
    this.input.current.select()
    this.input.current.focus()


ğŸ‡ï¼šåœ¨React 16.3ç‰ˆæœ¬åï¼Œä½¿ç”¨æ­¤æ–¹æ³•æ¥åˆ›å»ºrefã€‚å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡refæŒ‚è½½åœ¨domèŠ‚ç‚¹æˆ–ç»„ä»¶ä¸Šï¼Œè¯¥refçš„currentå±æ€§å°†èƒ½æ‹¿åˆ°domèŠ‚ç‚¹æˆ–ç»„ä»¶çš„å®ä¾‹ã€‚
    å½“refå±æ€§ç”¨äºæ™®é€š HTML å…ƒç´ æ—¶ï¼Œæ„é€ å‡½æ•°ä¸­ä½¿ç”¨ React.createRef() åˆ›å»ºçš„ ref æ¥æ”¶åº•å±‚ DOM å…ƒç´ ä½œä¸ºå…¶ current å±æ€§ã€‚
    å½“refå±æ€§ç”¨äºè‡ªå®šä¹‰ class ç»„ä»¶æ—¶ï¼Œref å¯¹è±¡æ¥æ”¶ç»„ä»¶çš„æŒ‚è½½å®ä¾‹ä½œä¸ºå…¶ current å±æ€§ã€‚

ğŸ¥šï¼šä¸èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨ ref å±æ€§ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰å®ä¾‹ã€‚(ä½†åœ¨å‡½æ•°å¼ç»„ä»¶å†…éƒ¨å¯ä»¥ä½¿ç”¨React Hooks ä½¿ç”¨ref,åæœŸæ›´æ–°)

----------------------

å—æ§ç»„ä»¶

åœ¨HTMLä¸­ï¼Œè¡¨å•å…ƒç´ ï¼ˆå¦‚ inputã€textareaã€selectï¼‰ä¹‹ç±»çš„è¡¨å•å…ƒç´ é€šå¸¸å¯ä»¥è‡ªå·±ç»´æŠ¤stateï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œæ›´æ–°ã€‚è€Œåœ¨Reactä¸­ï¼Œå¯å˜çŠ¶æ€ï¼ˆmutable stateï¼‰é€šå¸¸ä¿å­˜åœ¨ç»„ä»¶çš„ state å±æ€§ä¸­ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ setState()æ¥æ›´æ–°ã€‚æˆ‘ä»¬å°† Reactçš„stateä½œä¸ºå”¯ä¸€çš„æ•°æ®æºï¼Œé€šè¿‡æ¸²æŸ“è¡¨å•çš„Reactç»„ä»¶æ¥æ§åˆ¶ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­è¡¨å•å‘é€çš„æ“ä½œã€‚
è¿™ä¸ªâ€œè¢«Reacté€šè¿‡æ­¤ç§æ–¹å¼æ§åˆ¶å–å€¼çš„è¡¨å•è¾“å…¥å…ƒç´ â€è¢«æˆä¸ºå—æ§ç»„ä»¶ã€‚

ä¸å—æ§ç»„ä»¶

ä»å­—é¢æ„æ€æ¥ç†è§£ï¼šä¸è¢«Reactç»„ä»¶æ§åˆ¶çš„ç»„ä»¶ã€‚åœ¨å—æ§åˆ¶ç»„ä»¶ä¸­ï¼Œè¡¨å•æ•°æ®ç”± Reactç»„ä»¶å¤„ç†ã€‚å…¶æ›¿ä»£æ–¹æ¡ˆæ˜¯ä¸å—æ§åˆ¶ç»„ä»¶ï¼Œå…¶ä¸­è¡¨å•æ•°æ®ç”±DOMæœ¬èº«å¤„ç†ã€‚æ–‡ä»¶è¾“å…¥æ ‡ç­¾å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸å—æ§åˆ¶ç»„ä»¶ï¼Œå®ƒçš„å€¼åªèƒ½ç”±ç”¨æˆ·è®¾ç½®ï¼Œé€šè¿‡DOMè‡ªèº«æä¾›çš„ä¸€äº›ç‰¹æ€§æ¥è·å–ã€‚

å—æ§ç»„ä»¶å’Œä¸å—æ§ç»„ä»¶æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å‰è€…è‡ªèº«ç»´æŠ¤çš„çŠ¶æ€å€¼å˜åŒ–ï¼Œå¯ä»¥é…åˆè‡ªèº«çš„changeäº‹ä»¶ï¼Œå¾ˆå®¹æ˜“è¿›è¡Œä¿®æ”¹æˆ–è€…æ ¡éªŒç”¨æˆ·çš„è¾“å…¥ã€‚

åœ¨Reactä¸­ å› ä¸º Refsçš„å‡ºç°ä½¿å¾— ä¸å—æ§åˆ¶ç»„ä»¶è‡ªèº«çŠ¶æ€å€¼çš„ç»´æŠ¤å˜å¾—å®¹æ˜“äº†è®¸å¤šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é‡ç‚¹ä»‹ç»ä¸€ä¸‹ Refsåœ¨ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼ã€‚

refs é€šå¸¸é€‚åˆåœ¨ä¸€ä¸‹åœºæ™¯ä¸­ä½¿ç”¨ï¼š

  - å¯¹DOM å…ƒç´ ç„¦ç‚¹çš„æ§åˆ¶ã€å†…å®¹é€‰æ‹©æˆ–è€…åª’ä½“æ’­æ”¾ï¼›
  - é€šè¿‡å¯¹DOMå…ƒç´ æ§åˆ¶ï¼Œè§¦å‘åŠ¨ç”»ç‰¹æ•ˆï¼›
  - é€šç¬¬ä¸‰æ–¹DOMåº“çš„é›†æˆã€‚

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨React.createRef()

çˆ¶ç»„ä»¶
```
class ParentComp extends React.Component {
  constructor(props) {
    super(props);
    // åˆ›å»ºref æŒ‡å‘ ChildrenComp ç»„ä»¶å®ä¾‹
    this.textInput = React.createRef();
  }

  componentDidMount() {
    // è°ƒç”¨å­ç»„ä»¶ focusTextInputæ–¹æ³• è§¦å‘å­ç»„ä»¶å†…éƒ¨ æ–‡æœ¬æ¡†è·å–ç„¦ç‚¹äº‹ä»¶
    this.textInput.current.focusTextInput();
  }

  render() {
    return (
      <ChildrenComp ref={ this.textInput } />
    );
  }
}
```

å­ç»„ä»¶ä»£ç 

```
class ChildrenComp extends React.Component {
  constructor(props) {
    super(props);
    this.inputRef = React.createRef();
  }
  focusTextInput() {
    this.inputRef.current.focus();
  }
  render(){
    return(
      <div>
        <input type='text' value='çˆ¶ç»„ä»¶é€šè¿‡focusTextInput()æ–¹æ³•æ§åˆ¶è·å–ç„¦ç‚¹äº‹ä»¶' ref={ this.inputRef }/>
      </div>
    )
  }
}
```

å¦‚ä½•å°†DOM é€šè¿‡Refs æš´éœ²ç»™çˆ¶ç»„ä»¶

åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨çˆ¶ç»„ä»¶ä¸­å¼•ç”¨å­èŠ‚ç‚¹çš„ DOM èŠ‚ç‚¹ï¼ˆå®˜æ–¹ä¸å»ºè®®è¿™æ ·æ“ä½œï¼Œå› ä¸ºå®ƒä¼šæ‰“ç ´ç»„ä»¶çš„å°è£…ï¼‰ï¼Œç”¨æˆ·è§¦å‘ç„¦ç‚¹æˆ–è€…æµ‹é‡å­DOMèŠ‚ç‚¹çš„å¤§å°æˆ–è€…ä½ç½®ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘å­ç»„ä»¶æ·»åŠ  refçš„æ–¹å¼æ¥è§£å†³ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªç†æƒ³çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½è·å–ç»„ä»¶å®ä¾‹è€Œä¸æ˜¯ DOMèŠ‚ç‚¹ã€‚å¹¶ä¸”å®ƒè¿˜åœ¨å‡½æ•°ç»„ä»¶ä¸Šæ— æ•ˆã€‚

åœ¨react 16.3 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ ref è½¬å‘çš„æ–¹å¼æ¥å®ç°ä»¥ä¸Šæ“ä½œã€‚

Ref forwarding æ˜¯ä¸€ç§è‡ªåŠ¨å°†ref é€šè¿‡ç»„ä»¶ä¼ é€’ç»™å…¶å­èŠ‚ç‚¹
````
class TestComp extends React.Component {
  clickEvent() {
    if (ref && ref.current) {
      ref.current.addEventListener('click', () => {
        console.log('hello click!')
      });
    }
  }
  componentDidMount() {
    console.log('å½“å‰æŒ‰é’®çš„classä¸ºï¼š', ref.current.className); // btn
    this.clickEvent(); // hello click!
  }
  render() {
    return (
      <div>
        <BtnComp ref={ref}>ç‚¹å‡»æˆ‘</BtnComp>
      </div>
    );
  }
}
```

å­ç»„ä»¶
```
const ref = React.createRef();
const BtnComp = React.forwardRef((props, ref) => {
  return (
    <div>
      <button ref={ref} className='btn'>
        { props.children }
      </button>
    </div>
  )
});
```

ä½¿ç”¨çš„ç»„ä»¶BtnComp å¯ä»¥è·å–å¯¹åº•å±‚ button DOM èŠ‚ç‚¹çš„å¼•ç”¨å¹¶åœ¨å¿…è¦æ—¶å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå°±åƒæ­£å¸¸çš„HTMLå…ƒç´  buttonç›´æ¥ä½¿ç”¨DOMä¸€æ ·ã€‚
ç¬¬äºŒä¸ªrefå‚æ•°ä»…åœ¨ä½¿ç”¨React.forwardRef å›è°ƒ å®šä¹‰ç»„ä»¶æ—¶å­˜åœ¨ã€‚å¸¸è§„å‡½æ•°æˆ–ç±»ç»„ä»¶ä¸æ¥æ”¶refå‚æ•°ï¼Œå¹¶ä¸”åœ¨propsä¸­ä¹Ÿä¸æä¾›refã€‚

Refè½¬å‘ä¸ä»…é™äºDOMç»„ä»¶ã€‚æ‚¨ä¹Ÿå¯ä»¥å°†refsè½¬å‘ç»™ç±»ç»„ä»¶å®ä¾‹ã€‚

é«˜é˜¶ç»„ä»¶ä¸­çš„refs(å¾…å­¦æ›´)

å‚è€ƒåšå®¢ï¼š
[https://blog.csdn.net/zhang_xin_new/article/details/91458022](https://blog.csdn.net/zhang_xin_new/article/details/91458022)
[https://juejin.im/post/5c9d783cf265da60d0005390](https://juejin.im/post/5c9d783cf265da60d0005390)


